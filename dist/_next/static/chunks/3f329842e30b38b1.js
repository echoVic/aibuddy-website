(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,58887,e=>{"use strict";var a=e.i(47167),r=e.i(43476),t=e.i(71645),o=e.i(67881);let l=(0,e.i(75254).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);function n({product:e}){let[n,s]=(0,t.useState)(!0),[c,i]=(0,t.useState)(""),[d,y]=(0,t.useState)(!1),u=(0,t.useRef)(!1);return((0,t.useEffect)(()=>{if(document.getElementById("paypal-sdk")&&window.paypal){console.log("PayPal SDK already loaded"),y(!0),s(!1);return}let e=document.createElement("script");e.id="paypal-sdk",e.src=`https://www.sandbox.paypal.com/sdk/js?client-id=${a.default.env.NEXT_PUBLIC_PAYPAL_CLIENT_ID}&currency=USD&intent=capture`,e.async=!0,e.onload=()=>{console.log("PayPal SDK loaded successfully"),y(!0),s(!1)},e.onerror=e=>{console.error("PayPal SDK load error:",e),i("Failed to load PayPal SDK. Please refresh the page."),s(!1)},document.body.appendChild(e)},[]),(0,t.useEffect)(()=>{if(d&&window.paypal&&!u.current){console.log("Attempting to render PayPal buttons...");try{let a=window.paypal.Buttons({createOrder:async()=>{console.log("Creating order for product:",e.id);try{let a=await fetch("/api/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({productId:e.id,price:e.price,name:e.name})});if(!a.ok){let e=await a.text();throw console.error("Create order failed:",e),Error(`Failed to create order: ${e}`)}let{orderId:r}=await a.json();return console.log("Order created:",r),r}catch(e){throw console.error("Create order error:",e),e}},onApprove:async e=>{console.log("Payment approved:",e.orderID);try{if(!(await fetch("/api/capture",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:e.orderID})})).ok)throw Error("Payment capture failed");window.location.href="/dashboard?success=true"}catch(e){console.error("Capture error:",e),i("Payment failed. Please try again.")}},onError:e=>{console.error("PayPal button error:",e),i("PayPal error: "+e.message)},onCancel:()=>{console.log("Payment cancelled by user")}});if(!a.isEligible()){console.error("PayPal buttons are not eligible"),i("PayPal is not available for this transaction. Please try a different payment method.");return}a.render("#paypal-button-container").then(()=>{console.log("PayPal buttons rendered successfully"),u.current=!0}).catch(e=>{console.error("Failed to render PayPal buttons:",e),i("Failed to initialize PayPal. Please refresh the page.")})}catch(e){console.error("Error creating PayPal buttons:",e),i("PayPal initialization failed. Please try again.")}}},[d,e]),n)?(0,r.jsxs)(o.Button,{disabled:!0,className:"w-full",children:[(0,r.jsx)(l,{className:"mr-2 h-4 w-4 animate-spin"}),"Loading PayPal..."]}):c?(0,r.jsxs)("div",{className:"text-center space-y-2",children:[(0,r.jsx)("p",{className:"text-red-500 text-sm",children:c}),(0,r.jsx)(o.Button,{onClick:()=>window.location.reload(),variant:"outline",className:"w-full",children:"Retry"})]}):(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{id:"paypal-button-container",className:"min-h-[45px] flex justify-center"}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground text-center",children:"Secure payment powered by PayPal"})]})}e.s(["default",()=>n],58887)}]);